<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site com Layout Ajustável</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
  <style>
    /* Estilos gerais */
    *,
    *:before,
    *:after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background-color: #f8f3f3;
      font-family: Arial, sans-serif;
    }

    /* Layout principal */
    .main-container {
      display: flex;
      height: 95vh;
    }

    .content {
      flex: 100%;
      display: flex;
      flex-direction: column;
      gap: 1px;
      padding: 1px;
    }

    .container {
      padding: 30px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(128, 128, 128, 0.3);
      position: relative;
    }

    .flex-container {
      display: flex;
      gap: 10px;
      flex: 1;
    }

    .left-column {
      flex: 15%;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .right-column {
      flex: 85%;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .container2 {
      flex: 0.5;
    }

    .container3 {
      flex: 2.5;
    }

    .container4 {
      flex: 1;
    }

    .container5 {
      height: 150px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 10px;
    }

    .container6 {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
    }

    /* Estilos responsivos */
    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
      }

      .content {
        flex: 100%;
      }

      .flex-container {
        flex-direction: column;
      }

      .left-column,
      .right-column {
        flex: 1;
      }

      .container5 {
        height: auto;
        padding: 10px;
      }

      .container6 {
        height: auto;
        padding: 10px;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 0;
      }

      .container {
        padding: 10px;
      }

      .container5,
      .container6 {
        font-size: 14px;
      }
    }


    /* Sidebar */
    nav {
      position: fixed;
      top: 70%;
      left: 0;
      transform: translateY(-50%);
      background: transparent;
      width: 70px;
      height: 70%;
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    nav ul {
      text-align: center;
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 12px;
    }

    nav ul li {
      position: relative;
      width: 70px;
      height: 70px;
      cursor: pointer;
      background: crimson;
      text-transform: uppercase;
      transition: all 0.4s ease-out;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    nav ul li:after {
      position: absolute;
      background: white;
      color: crimson;
      top: 0;
      left: 70px;
      width: 70px;
      height: 100%;
      opacity: .5;
      transform: perspective(400px) rotateY(90deg);
      transform-origin: 0 100%;
      transition: all 0.4s ease-out;
    }

    nav ul li:nth-child(1):after {
      content: "Status";
      line-height: 88px;
    }

    nav ul li:nth-child(2):after {
      content: "Agenda";
      line-height: 88px;
    }

    nav ul li:nth-child(3):after {
      content: "Registro";
      line-height: 85px;
    }

    nav ul li:nth-child(4):after {
      content: "Ação";
      line-height: 70px;
    }

    nav ul li:hover {
      transform: translateX(-70px);
    }

    nav ul li:hover:after {
      opacity: 1;
      transform: perspective(400px) rotateY(0deg) scale(1);
    }

    nav ul li>div {
      display: inline-block;
      padding: 25px 0;
      background: transparent;
    }

    nav ul li div {
      position: relative;
    }

    .fa-home,
    .fa-calendar,
    .fa-clipboard-list,
    .fa-bullhorn {
      font-size: 32px;
      color: white;
    }

    nav ul li:hover .fa-home,
    nav ul li:hover .fa-calendar,
    nav ul li:hover .fa-clipboard-list,
    nav ul li:hover .fa-bullhorn {
      color: crimson;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
    }

    /* Seções */
    section {
      margin-left: 70px;
      padding: 20px;
      display: none;
      height: 100vh;
    }

    section.active {
      display: block;
    }

    nav ul li.active {
      background-color: #444;
    }

    /* Estilos do Título */
    .container5 h2 {
      font-size: 40px;
      font-weight: bold;
      margin: 0;
    }

    .container5 .sub-title {
      font-size: 20px;
      font-weight: normal;
      margin-top: 5px;
    }

    /* Novo container para as páginas Agenda, Registro e Ação */
    .acao-container {
      width: 100%;
      height: 100%;
      padding: 20px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(128, 128, 128, 0.3);
      position: relative;
      overflow: hidden;
    }

    /* Estilo do ícone de adição */
    .add-icon {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      background-color: crimson;
      color: white;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    /* Estilo do modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      /* Garante que o modal fique acima de tudo */
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 800px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    /* Ajustes para telas menores */
    @media (max-width: 768px) {
      .modal-content {
        width: 90%;
      }
    }

    @media (max-width: 480px) {
      .modal-content {
        width: 95%;
        padding: 15px;
      }

      .form-group input,
      .form-group textarea {
        padding: 8px;
      }

      .form-group button {
        font-size: 14px;
        padding: 8px 16px;
      }
    }

    /* Estilo dos campos do modal */
    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
    }

    .form-group.inline {
      display: flex;
      justify-content: space-between;
    }

    .form-group.inline input#quem {
      flex-grow: 2;
      width: 600px;
    }

    .form-group.inline input#quando {
      flex-grow: 1;
    }

    .form-group textarea#como {
      height: 150px;
    }

    .form-group button {
      background-color: crimson;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 16px;
      display: block;
      margin: 0 auto;
    }

    /* Estilo para centralizar a animação */
    .loading-animation {
      display: flex;
      justify-content: center;
      /* Centraliza horizontalmente */
      align-items: center;
      /* Centraliza verticalmente */
      width: 100%;
      height: 100%;
      /* Ocupa toda a altura do container */
      margin-top: 15%;
    }

    /* Estilo da tabela */
    .table-container {
      overflow-y: auto;
      /* Barra de rolagem vertical */
      height: calc(100% - 40px);
      /* Altura da tabela */
      position: relative;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 0 auto;
      font-size: 14px;
      table-layout: auto;
      /* Ajusta as colunas automaticamente */
    }

    th,
    td {
      padding: 8px;
      border: 1px solid #ddd;
      word-wrap: break-word;
      /* Quebra de linha no conteúdo */
      text-align: center;
      /* Centraliza o texto nas colunas */
    }

    th {
      background-color: #e0e0e0;
      /* Cinza mais forte para o título da tabela */
      color: #333;
      /* Cor do texto do título */
      position: sticky;
      top: 0;
      z-index: 10;
    }

    tr {
      background-color: #f9f9f9;
      /* Cinza bem fraco para as linhas da tabela */
    }

    tr:nth-child(even) {
      background-color: #f1f1f1;
      /* Cinza um pouco mais escuro para linhas pares */
    }

    /* Coluna Ações com cinza fraco */
    td.action-icons {
      background-color: #f9f9f9;
      /* Cinza bem fraco para a coluna Ações */
    }

    /* Ícones de ação */
    .action-icons {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .action-icons i {
      cursor: pointer;
      color: #333;
      font-size: 18px;
    }

    .action-icons i:hover {
      color: crimson;
    }

    /* Barra de rolagem */
    .table-container::-webkit-scrollbar {
      width: 6px;
      /* Largura reduzida da barra de rolagem */
    }

    .table-container::-webkit-scrollbar-thumb {
      background-color: crimson;
      /* Cor do thumb (vermelho) */
      border-radius: 6px;
      /* Arredondamento */
    }

    .table-container::-webkit-scrollbar-track {
      background-color: #f1f1f1;
      /* Cor do track */
    }

    /* Sidebar dentro do container Ação */
    .acao-sidebar {
      position: absolute;
      top: 0;
      right: 0;
      width: auto;
      background: transparent;
      z-index: 10;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 10px;
    }

    .acao-sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      justify-content: space-around;
    }

    .acao-sidebar ul li {
      position: relative;
      width: 100px;
      height: 60px;
      cursor: pointer;
      background: crimson;
      text-transform: uppercase;
      transition: all 0.4s ease-out;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 0 !important;
    }

    /* Estilos para os logos das marcas */
    .acao-sidebar ul li img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      transition: opacity 0.4s ease-out;
    }

    /* Arredondar bordas específicas */
    .acao-sidebar ul li:first-child {
      border-top-left-radius: 10px;
      border-bottom-left-radius: 10px;
    }

    .acao-sidebar ul li:last-child {
      border-top-right-radius: 10px;
      border-bottom-right-radius: 10px;
    }

    .acao-sidebar ul li:after {
      position: absolute;
      background: white;
      color: crimson;
      top: 100%;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      transform: translateY(0);
      transition: all 0.4s ease-out;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 16px;
      font-weight: bold;
    }

    .acao-sidebar ul li:nth-child(1):after {
      content: "ASICS";
    }

    .acao-sidebar ul li:nth-child(2):after {
      content: "FILA";
    }

    .acao-sidebar ul li:nth-child(3):after {
      content: "UMBRO";
    }

    .acao-sidebar ul li:hover {
      background: transparent;
    }

    .acao-sidebar ul li:hover:after {
      opacity: 1;
      transform: translateY(-100%);
    }

    /* Esconde o logo ao passar o mouse */
    .acao-sidebar ul li:hover img {
      opacity: 0;
    }

    /* Remove estilos desnecessários */
    /*.acao-sidebar ul li:hover .fa-home,
    .acao-sidebar ul li:hover .fa-calendar,
    .acao-sidebar ul li:hover .fa-clipboard-list {
      opacity: 0;
    }*/

    .acao-sidebar ul li>div {
      display: inline-block;
      padding: 25px 0;
      background: transparent;
    }

    .acao-sidebar ul li div {
      position: relative;
    }

    /* Estilos da tabela */
    #tabela-producao {
      flex: 1;
      overflow-y: auto;
      margin-top: 20px;
    }

    #tabela-producao::-webkit-scrollbar {
      width: 2px;
      opacity: 90%;

    }

    #tabela-producao::-webkit-scrollbar-thumb {
      background-color: rgba(220, 20, 60, 0.521);
      opacity: 90%;
      border-radius: 3px;
    }

    #tabela-producao::-webkit-scrollbar-track {
      background-color: #f1f1f1;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: auto;
      /* Adicionado para ajuste automático das colunas */
      font-size: 12px;
      /* Diminui o tamanho da fonte */
    }

    th,
    table td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: center;
    }

    th {
      background-color: crimson;
      color: white;
      position: sticky;
      /* Adiciona a propriedade sticky */
      top: 0;
      /* Fixa o cabeçalho no topo */
      z-index: 1;
      /* Garante que o cabeçalho fique acima do conteúdo da tabela */
    }

    table tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    table tr:hover {
      background-color: #f1f1f1;
    }

    /* Fixar o título da tabela */
    .fixed-title {
      position: sticky;
      top: 0;
      background-color: white;
      z-index: 1;
      padding: 10px;
      border-bottom: 1px solid #ccc;
    }

    /* Estilos para o bloco selecionado */
    .acao-sidebar ul li.selecionado {
      background-color: #333 !important;
    }

    /* Cor do ícone quando selecionado */
    .acao-sidebar ul li.selecionado i {
      color: #fff !important;
    }

    /* Animação de carregamento */
    .loading-animation {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.8);
      z-index: 100;
    }



    /* Novo container para a página Ação */
    .acao-container {
      width: 100%;
      height: 100%;
      padding: 20px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(128, 128, 128, 0.3);
      position: relative;
      /* Garante que o calendário fique dentro do container */
      overflow: hidden;
      /* Impede que o conteúdo saia do container */
    }

    /* Estilo do calendário */
    #calendar-container {
      position: relative;
      /* Posicionamento relativo ao .acao-container */
      width: 100%;
      /* Ocupa 100% da largura do container */
      height: 90%;
      /* Ocupa 100% da altura do container */
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      /* Alinha o conteúdo ao topo */
      align-items: center;
      visibility: hidden;
      /* Inicialmente oculto */
    }

    .month-name {
      text-align: center;
      font-size: 2.5em;
      margin-bottom: 1px;
      /* Reduz o espaço abaixo do nome do mês */
    }

    #calendar {
      display: grid;
      grid-template-columns: 1fr repeat(5, 1fr);
      /* Grade com 6 colunas */
      gap: 5px;
      /* Espaçamento entre os elementos ajustado para 60px */
      margin: auto;
      width: 100%;
      max-width: 100%px;
      height: 90%;
      max-height: 100%px;
    }

    .week-number {
      text-align: center;
      font-weight: bold;
      padding: 40px;
      border-right: 1px solid #ddd;
      background-color: #f0f0f0;
    }

    .day {
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
      border-radius: 5px;
      min-height: 50px;
    }

    .day-header {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: #f9f9f9;
    }

    .day-header span {
      text-align: center;
      font-weight: bold;
    }

    .event {
      padding: 20px;
      margin-top: 5px;
      border-radius: 3px;
      color: #fff;
      font-size: 0.8em;
      font-size: 18px;
    }

    .empty {
      background-color: #f9f9f9;
      border: none;
    }

    /* Mapear cores para os tipos de evento */
    .Melhoria-Contínua {
      background-color: #4CAF50;
    }

    .Modelagem {
      background-color: #2196F3;
    }

    .Qualidade {
      background-color: #48f051;
    }

    .SSMA {
      background-color: #8927b0;
    }

    .PCP {
      background-color: #f03022;
    }

    .Crono {
      background-color: #55e9e1;
    }

    .RH {
      background-color: #db2fb6;
    }

    .Laboratório {
      background-color: #67814a;
    }

    .Manutenção {
      background-color: #fd6030;
    }

    .TO {
      background-color: #607D8B;
    }

    .P5S {
      background-color: #d7ee08;
    }

    /* Estilo da animação */
    .loading-animation {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 300px;
      height: 300px;
      visibility: visible;
    }
    .loading-animation2 {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.8);
      z-index: 100;
    }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <nav>
    <ul>
      <li id="statusNav" onclick="showPage('status')">
        <div>
          <i class="fas fa-home"></i>
        </div>
      </li>
      <li id="agendaNav" onclick="showPage('agenda')">
        <div>
          <i class="fas fa-calendar"></i>
        </div>
      </li>
      <li id="registroNav" onclick="showPage('registro')">
        <div>
          <i class="fas fa-clipboard-list"></i>
        </div>
      </li>
      <li id="acaoNav" onclick="showPage('acao')">
        <div>
          <i class="fas fa-bullhorn"></i>
        </div>
      </li>
    </ul>
  </nav>

  <!-- Seções -->
  <section id="status" class="page active">
    <div class="main-container">
      <div class="content">
        <div class="flex-container">
          <div class="left-column">
            <div class="container container2">
              <div class="barcode-field">
                <i class="fas fa-barcode"></i>
                <input type="text" placeholder="Digite o código de barras">
              </div>
            </div>
            <div class="container container3">
              <h2>Container 3</h2>
            </div>
            <div class="container container4">
              <h2>Container 4</h2>
            </div>
          </div>
          <div class="right-column">
            <div class="container container5">
              <h2>SIGA</h2>
              <div class="sub-title">Sistema integrado de gestão aplicada</div>
            </div>
            <div class="container container6">
              <h2>Container 6</h2>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="agenda" class="page">
    <div class="acao-container">
      <div id="calendar-container">
        <div id="month-name" class="month-name"></div>
        <p>Calendário de Apresentação de Gerenciamento Diário</p>
        <div id="calendar"></div>
        <div class="loading-animation">
          <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs"
            type="module"></script>
          <dotlottie-player src="https://lottie.host/c306cfff-12a7-48cd-a5c4-5bc0f80f6003/6X1VG6ZT4B.lottie"
            background="transparent" speed="1" style="width: 300px; height: 300px" loop autoplay></dotlottie-player>
        </div>
      </div>
    </div>
  </section>

  <section id="registro" class="page">
    <div class="acao-container">
      <h2>Plano de Ação</h2>
      <!-- Container onde a tabela será inserida -->
      <div class="table-container">
        <div id="registroTableContainer">
          <div class="loading-animation">
            <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs"
              type="module"></script>
            <dotlottie-player src="https://lottie.host/c306cfff-12a7-48cd-a5c4-5bc0f80f6003/6X1VG6ZT4B.lottie"
              background="transparent" speed="1" style="width: 300px; height: 300px" loop autoplay>
            </dotlottie-player>
          </div>
        </div>
      </div>
      <button class="add-icon" onclick="openModal()">+</button>
    </div>
  </section>

  <section id="acao" class="page">
    <div class="acao-container">
      <h2 class="fixed-title">Acompanhamento Semanal</h2>

      <!-- Sidebar dentro do container Ação -->
      <div class="acao-sidebar">
        <ul>
          <li id="filtroASICS" onclick="filtrarTabela('ASICS')">
            <div>
              <img src="https://i.postimg.cc/gkYJWM1C/logo-das-marcas-page-0003-removebg-preview.png" alt="ASICS">
            </div>
          </li>
          <li id="filtroFILA" onclick="filtrarTabela('FILA')">
            <div>
              <img src="https://i.postimg.cc/HW0xFGv0/logo-das-marcas-page-0001-removebg-preview.png" alt="FILA">
            </div>
          </li>
          <li id="filtroUMBRO" onclick="filtrarTabela('UMBRO')">
            <div>
              <img src="https://i.postimg.cc/nrxLMTrQ/logo-das-marcas-page-0002-removebg-preview-1.png" alt="UMBRO">
            </div>
          </li>
        </ul>
      </div>

      <!-- Animação de carregamento -->
      <div class="loading-animation2">
        <dotlottie-player src="https://lottie.host/c306cfff-12a7-48cd-a5c4-5bc0f80f6003/6X1VG6ZT4B.lottie"
          background="transparent" speed="1" style="width: 300px; height: 300px" loop autoplay>
        </dotlottie-player>
      </div>

      <!-- Tabela de Acompanhamento Semanal -->
      <div id="tabela-producao"></div>
    </div>
  </section>

  <!-- Modal -->
  <div id="myModal" class="modal">
    <div class="modal-content">
      <h2>Registrar Ação</h2>
      <form id="acaoForm">
        <div class="form-group">
          <label for="oque">O quê?</label>
          <input type="text" id="oque" placeholder="O quê aconteceu?" required>
        </div>
        <div class="form-group">
          <label for="como">Como?</label>
          <textarea id="como" placeholder="Descreva o que aconteceu..." required></textarea>
        </div>
        <div class="form-group">
          <label for="quem">Quem?</label>
          <input type="text" id="quem" placeholder="Quem?" required>
        </div>
        <div class="form-group">
          <label for="quando">Quando?</label>
          <input type="datetime-local" id="quando" required onchange="this.blur()">
        </div>
        <div class="form-group">
          <button type="submit">Salvar</button>
        </div>
      </form>
    </div>
  </div>


  <script>
    let dadosTabela = []; // Variável global para armazenar os dados da tabela
    let cabecalho = []; // Variável global para armazenar o cabeçalho da tabela

    function showPage(page) {
      var sections = document.querySelectorAll('.page');
      sections.forEach(function (section) {
        section.classList.remove('active');
      });
      var activePage = document.getElementById(page);
      activePage.classList.add('active');
      var navItems = document.querySelectorAll('nav ul li');
      navItems.forEach(function (item) {
        item.classList.remove('active');
      });
      var activeNavItem = document.getElementById(page + "Nav");
      activeNavItem.classList.add('active');
    }

    // Função para carregar os dados da API do Google Apps Script
    async function carregarDadosPlanilha() {
      const url = "https://script.google.com/macros/s/AKfycbwESLf8Xf98nhKuSM9xwDBg0PUdnWfISKSRydtUOHh4po135_d6zmpWC-AFee2N4UiMEw/exec"; // URL do Web App

      try {
        const response = await fetch(url);
        const data = await response.json();
        dadosTabela = data; // Armazena os dados na variável global
        cabecalho = Object.keys(data[0]); // Armazena o cabeçalho
        // Classificar os dados pela coluna "Semana" do menor para o maior
        dadosTabela.sort((a, b) => {
          const semanaA = parseInt(a["Semana"]);
          const semanaB = parseInt(b["Semana"]);
          return semanaA - semanaB;
        });
        criarTabela(dadosTabela); // Cria a tabela com os dados carregados
      } catch (error) {
        console.error("Erro ao carregar os dados da API:", error);
      }
    }

    // Função para criar a tabela
    function criarTabela(dados) {
      const tabela = document.createElement("table");
      const thead = document.createElement("thead");
      const tbody = document.createElement("tbody");

      // Cabeçalho da tabela
      const trHead = document.createElement("tr");
      cabecalho.forEach(coluna => {
        const th = document.createElement("th");
        th.textContent = coluna;
        trHead.appendChild(th);
      });
      thead.appendChild(trHead);
      tabela.appendChild(thead);

      // Dados da tabela
      dados.forEach(linha => {
        const tr = document.createElement("tr");
        cabecalho.forEach(coluna => {
          const td = document.createElement("td");
          td.textContent = linha[coluna];
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      tabela.appendChild(tbody);

      // Adicionar a tabela ao container
      const containerTabela = document.getElementById("tabela-producao");
      containerTabela.innerHTML = ""; // Limpa o conteúdo anterior
      containerTabela.appendChild(tabela);

      // Remover a animação de carregamento
      const loadingAnimation = document.querySelector(".loading-animation2");
      if (loadingAnimation) {
        loadingAnimation.style.display = "none";
      }
    }

    // Função para filtrar a tabela
    function filtrarTabela(filtro) {
      const dadosFiltrados = dadosTabela.filter(linha => linha[cabecalho[0]] === filtro);
      criarTabela(dadosFiltrados);

      // Remover a classe 'selecionado' de todos os blocos
      document.querySelectorAll('.acao-sidebar ul li').forEach(item => {
        item.classList.remove('selecionado');
      });

      // Adicionar a classe 'selecionado' ao bloco clicado
      document.getElementById('filtro' + filtro).parentNode.classList.add('selecionado');
    }

    // Adiciona um evento de clique para cada item do menu
    document.addEventListener('DOMContentLoaded', function () {
      const menuItems = document.querySelectorAll('.acao-sidebar ul li');

      menuItems.forEach(item => {
        item.addEventListener('click', function () {
          // Remover a classe 'selecionado' de todos os itens
          menuItems.forEach(menuItem => {
            menuItem.classList.remove('selecionado');
          });

          // Adicionar a classe 'selecionado' ao item clicado
          this.classList.add('selecionado');
        });
      });

      // Carrega os dados da planilha ao carregar a página
      carregarDadosPlanilha();
    });
    // Função para formatar data para o padrão brasileiro: DD/MM/AAAA HH:mm:ss
    function formatDateBR(date) {
      return String(date.getDate()).padStart(2, '0') + '/' +
        String(date.getMonth() + 1).padStart(2, '0') + '/' +
        date.getFullYear() + ' ' +
        String(date.getHours()).padStart(2, '0') + ':' +
        String(date.getMinutes()).padStart(2, '0') + ':' +
        String(date.getSeconds()).padStart(2, '0');
    }

    // Função auxiliar para garantir a formatação das datas recebidas (quando e dataAtual)
    function formatBrazilianDate(value) {
      // Se for um objeto Date, formata diretamente
      if (value instanceof Date) {
        return formatDateBR(value);
      }
      // Se for uma string com traços (ISO), tenta converter para Date
      if (typeof value === 'string' && value.indexOf('-') !== -1) {
        const date = new Date(value);
        if (!isNaN(date.getTime())) {
          return formatDateBR(date);
        }
      }
      // Retorna o valor caso já esteja formatado
      return value;
    }

    function openModal() {
      document.getElementById("myModal").style.display = "block";
    }
    function closeModal() {
      document.getElementById("myModal").style.display = "none";
    }
    window.onclick = function (event) {
      if (event.target == document.getElementById("myModal")) {
        closeModal();
      }
    };

    // Função para alternar entre as seções
    function showPage(page) {
      const pages = document.querySelectorAll("section");
      pages.forEach(p => p.classList.remove("active"));
      document.getElementById(page).classList.add("active");
      // Se for a página de registro, busca os dados
      if (page === "registro") {
        fetchRegistroData();
      }
    }

    // Envio dos dados do formulário para o Google Sheets (POST)
    document.getElementById("acaoForm").addEventListener("submit", function (event) {
      event.preventDefault();

      const oque = document.getElementById("oque").value;
      const como = document.getElementById("como").value;
      const quem = document.getElementById("quem").value;
      const quandoValue = document.getElementById("quando").value;

      // Validação do campo "quando"
      if (!quandoValue) {
        alert("O campo 'Quando?' é obrigatório.");
        return;
      }

      // Converte o valor do input datetime-local para objeto Date e formata
      const quandoData = new Date(quandoValue);
      if (isNaN(quandoData.getTime())) {
        alert("A data 'Quando?' é inválida. Por favor, insira uma data válida.");
        return;
      }

      // Data e hora atual
      const now = new Date();

      const data = {
        oque: oque,
        como: como,
        quem: quem,
        quando: quandoData.toISOString(), // Envia no formato ISO
        dataAtual: now.toISOString() // Envia no formato ISO
      };

      // URL atualizada do Google Apps Script (POST)
      const url = "https://script.google.com/macros/s/AKfycby-dF2QUlXe5PLH4Gqio_70vdMhmfotFKLiYzzKtgoG8ZiNgNxfJg1-fzkVx4_YU5HIug/exec";

      fetch(url, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
        .then(response => {
          // Em modo no-cors a resposta é opaca
        })
        .then(text => {
          closeModal();
          document.getElementById("acaoForm").reset();
          // Atualiza a tabela após salvar
          fetchRegistroData();
        })
        .catch(error => {
          console.error('Erro:', error);
          alert('Erro ao salvar os dados: ' + error.message);
        });
    });

    // Função para buscar os dados do Google Sheets via doGet e preencher a tabela na página Registro
    function fetchRegistroData() {
      // URL atualizada do Google Apps Script (GET)
      const url = "https://script.google.com/macros/s/AKfycby-dF2QUlXe5PLH4Gqio_70vdMhmfotFKLiYzzKtgoG8ZiNgNxfJg1-fzkVx4_YU5HIug/exec";
      const container = document.getElementById("registroTableContainer");

      fetch(url)
        .then(response => response.json())
        .then(result => {
          if (result.result === "success" && result.data.length > 0) {
            // Ordena os dados pela coluna "quando" do menor para o maior
            result.data.sort((a, b) => new Date(a.quando) - new Date(b.quando));

            let table = "<table border='1' style='width:100%; border-collapse:collapse;'>";
            table += "<thead><tr>";
            const headers = Object.keys(result.data[0]);

            // Altera o título da coluna "dataAtual" para "Data de Registro"
            headers.forEach(header => {
              if (header.toLowerCase() === "dataatual") {
                table += "<th style='padding: 8px;'>Data de Registro</th>";
              } else {
                table += "<th style='padding: 8px;'>" + header + "</th>";
              }
            });

            // Adiciona a coluna de ações
            table += "<th style='padding: 8px;'>Ações</th>";

            table += "</tr></thead>";
            table += "<tbody>";
            result.data.forEach(row => {
              table += "<tr>";
              headers.forEach(header => {
                let value = row[header];
                // Formata os campos "quando" e "dataAtual" para o padrão brasileiro
                if (header.toLowerCase() === "quando" || header.toLowerCase() === "dataatual") {
                  value = formatBrazilianDate(value);
                }
                table += "<td style='padding: 8px; text-align: center;'>" + value + "</td>";
              });
              // Adiciona os ícones de ação (Concluir, Editar, Excluir)
              table += "<td class='action-icons'>";
              table += "<i class='fas fa-check-circle' onclick='markAsCompleted(" + row.id + ")'></i>";
              table += "<i class='fas fa-edit' onclick='editAction(" + row.id + ")'></i>";
              table += "<i class='fas fa-trash-alt' onclick='deleteAction(" + row.id + ")'></i>";
              table += "</td>";
              table += "</tr>";
            });
            table += "</tbody></table>";
            container.innerHTML = table;
          } else if (result.result === "empty") {
            container.innerHTML = "<p>Nenhum registro encontrado.</p>";
          } else {
            container.innerHTML = "<p>Erro ao carregar os dados.</p>";
          }
        })
        .catch(error => {
          console.error("Erro ao buscar registros:", error);
          container.innerHTML = "<p>Erro ao carregar os dados.</p>";
        });
    }

    // Função para marcar a ação como concluída
    function markAsCompleted(id) {
      alert("Ação " + id + " marcada como concluída!");
      // Aqui você pode adicionar lógica para atualizar a planilha
    }

    // Função para editar a ação
    function editAction(id) {
      alert("Editando ação " + id + "...");
      // Aqui você pode adicionar lógica para abrir o modal de edição
    }

    // Função para excluir a ação
    function deleteAction(id) {
      if (confirm("Tem certeza de que deseja excluir a ação " + id + "?")) {
        // URL para deletar a ação
        const deleteUrl = "https://script.google.com/macros/s/AKfycby-dF2QUlXe5PLH4Gqio_70vdMhmfotFKLiYzzKtgoG8ZiNgNxfJg1-fzkVx4_YU5HIug/exec?action=delete&id=" + id;

        fetch(deleteUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
        })
          .then(response => response.json())
          .then(result => {
            if (result.result === "success") {
              alert("Ação " + id + " excluída com sucesso!");
              // Atualiza a tabela após a exclusão
              fetchRegistroData();
            } else {
              alert("Erro ao excluir ação: " + result.error);
            }
          })
          .catch(error => {
            console.error('Erro:', error);
            alert('Erro ao excluir ação: ' + error.message);
          });
      }
    }
    const apiUrl = 'https://script.googleusercontent.com/macros/echo?user_content_key=u6an7DmMwbTRSqgCzSSj18QkMm9FkKP7TjiHZvtuwwuabQgJbH_vXkUCpkP_bz7fNyvX8WwFSEaW-q-Kn--w4UYlsaDxfH8Zm5_BxDlH2jW0nuo2oDemN9CCS2h10ox_1xSncGQajx_ryfhECjZEnLzbrW3C0aaGYoGc3Os_YIXkZ4ElC5Uo3GkCt1RTFyoBw4uG79e7HIibUOXsHD_V6lfl4ZCZemkNrlYsyWg1M7AHyAdnuSA8ZQ&lib=M9rsdY6BuFXkfwT8dhYn0fp_qiD-HiESj';

    function getWeekNumber(date) {
      const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
      d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
      const startDate = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      return Math.ceil((((d - startDate) / 86400000) + 1) / 7);
    }

    function getEventsFromSheet() {
      fetch(apiUrl)
        .then(response => response.json())
        .then(eventsByDate => {
          generateCalendar(eventsByDate);
          document.querySelector('.loading-animation').style.visibility = 'hidden'; // Oculta a animação após o carregamento
          document.getElementById('calendar-container').style.visibility = 'visible'; // Mostra o calendário após o carregamento
        })
        .catch(error => console.error('Erro ao buscar dados da API:', error));
    }

    function generateCalendar(eventsByDate) {
      const calendarElement = document.getElementById('calendar');
      const monthNameElement = document.getElementById('month-name');
      const currentDate = new Date();
      const monthNames = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];

      const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
      const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
      const totalDays = lastDay.getDate();

      let currentWeekNumber = null;
      let weekHasDates = false;

      monthNameElement.innerText = `${monthNames[currentDate.getMonth()]}`;
      calendarElement.innerHTML = "";

      const weekHeader = document.createElement('div');
      weekHeader.classList.add('week-number');
      weekHeader.innerText = "Semana";
      calendarElement.appendChild(weekHeader);

      ['SEG', 'TER', 'QUA', 'QUI', 'SEX'].forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.classList.add('day-header');
        dayHeader.innerHTML = `<span>${day}</span>`;
        calendarElement.appendChild(dayHeader);
      });

      let weekStartDay = null;
      let lastDisplayedWeekNumber = null;

      for (let day = 1; day <= totalDays; day++) {
        const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
        const weekNumber = getWeekNumber(date);
        const dayOfWeek = date.getDay();

        if (dayOfWeek === 0 || dayOfWeek === 6) continue;

        if (date.getMonth() !== currentDate.getMonth()) continue;

        if (weekNumber !== lastDisplayedWeekNumber) {
          lastDisplayedWeekNumber = weekNumber;

          const weekNumberElement = document.createElement('div');
          weekNumberElement.classList.add('week-number');
          weekNumberElement.innerText = `Semana ${weekNumber}`;
          calendarElement.appendChild(weekNumberElement);
        }

        const dayElement = document.createElement('div');
        dayElement.classList.add('day');
        dayElement.innerHTML = `<strong>${day}</strong>`;

        const dayString = `${day}/${currentDate.getMonth() + 1}/${currentDate.getFullYear()}`;
        if (eventsByDate[dayString]) {
          eventsByDate[dayString].forEach(event => {
            const eventElement = document.createElement('div');
            eventElement.classList.add('event', event.replace(/ /g, '-'));
            eventElement.innerText = event;
            dayElement.appendChild(eventElement);
          });
        }

        calendarElement.appendChild(dayElement);
      }
    }

    getEventsFromSheet();
  </script>
</body>

</html>
